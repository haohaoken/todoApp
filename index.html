<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="Todo App with A Clock">
    <meta name="author" content="Ken Jianhao Wu">
    <title>TodoApp</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.13.1/umd/react.development.js" 
    integrity="sha256-4gJGEx/zXAxofkLPGXiU2IJHqSOmYV33Ru0zw0TeJ30=" 
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.13.1/umd/react-dom.development.js" 
    integrity="sha256-/z9BuuCDG5rQaHQBQWtzk3dBOTjTAOrn+SUSRGDjR40=" 
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js" 
    integrity="sha256-L/S5mZS8SPJVWoKym3Zwgf2f3/s3X3MaZ7QBA9HdnN8=" 
    crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="clock"></div>
    <div id="todos"></div>
    <script type="text/babel">
      class Clock extends React.Component {
        constructor() {
          super();
          this.state = { date : new Date() };
        }

        componentDidMount() {
          this.timeID = setInterval(
            () => this.tick(), 
            1000,
            );
        }

        componentWillUnmount() {
          clearInterval(this.timeID);
        }

        tick() {
          this.setState({ date : new Date() });
        }

        render() {
          return (
            <div>
              <h1>Welcome to Todo App</h1>
              <h2>Now it is {this.state.date.toLocaleTimeString()}.</h2>
            </div>
          );
        }
      }

      class TodoApp extends React.Component {
        constructor() {
          super();
          this.state = { todos: [] };
        }

        handleAddTodo = (text) => {
          this.setState(prevState => {
            if (!prevState.todos.some(todo => todo.text === text)) {
              return {
                todos: [...prevState.todos, { id: new Date().getTime(), text}]
              };
            }
          });
        }

        handleDeleteTodo = (id) => {
          this.setState(prevState => ({
            todos: [...prevState.todos.filter(todo => todo.id !== id)]
          }));
        }

        render() {
          return (
            <div>
              <TodoList todos={this.state.todos} handleDeleteTodo={this.handleDeleteTodo} />
              <UserInput length={this.state.todos.length} handleAddTodo={this.handleAddTodo} />
            </div>
          );
        }
      }

      class UserInput extends React.Component {
        constructor() {
          super();
          this.state = { userInput: "" };
        }

        handleInputChange = (event) => {
          const userInput = event.target.value;
          this.setState({ userInput });
        }

        handleAdd = () => {
          const userInput = this.state.userInput;
          if (userInput) {
            this.props.handleAddTodo(userInput);
          }
          this.setState({ userInput: "" });
        }

        render() {
          return (
            <div>
              <p>What needs to be done?</p>
              <input value={this.state.userInput} onChange={this.handleInputChange} />
              <button onClick={this.handleAdd}>Add #{this.props.length + 1}</button>
            </div>
          );
        }
      }

      function TodoList(props) {
        return (
          <ul>
            {props.todos.map(todo => (
              <TodoItem 
                key={todo.id}
                todo={todo}
                handleDeleteTodo={props.handleDeleteTodo} />
            ))}
          </ul>
        );
      }

      class TodoItem extends React.Component {
        constructor() {
          super();
          this.state = { done: false };
        }

        onClick = () => {
          this.setState(prevState => ({ done: !prevState.done }));
        }

        onDelete = () => {
          this.props.handleDeleteTodo(this.props.todo.id);
        }

        render() {
          return (
            <li>
              <button onClick={this.onClick}>
                {this.state.done ? "Undo" : "Done"}
              </button>
              <span style={{
                textDecoration: this.state.done ? "line-through" : "none"
              }}>
                {this.props.todo.text}
              </span>
              <button onClick={this.onDelete}>
                X
              </button>
            </li>
          );
        }
      }

      ReactDOM.render(<Clock />, document.getElementById("clock"));
      ReactDOM.render(<TodoApp />, document.getElementById("todos"));
    </script>
  </body>
</html>